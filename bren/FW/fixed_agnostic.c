#include <brender.h>
#include <brbuiltin.h>
#include <math.h>

static br_angle const __sincos_table[] = {
    0x0000, 0x0324, 0x0647, 0x096A, 0x0C8B, 0x0FAB, 0x12C7, 0x15E1, 0x18F8, 0x1C0B, 0x1F19, 0x2223, 0x2527, 0x2826,
    0x2B1E, 0x2E10, 0x30FB, 0x33DE, 0x36B9, 0x398C, 0x3C56, 0x3F16, 0x41CD, 0x447A, 0x471C, 0x49B3, 0x4C3F, 0x4EBF,
    0x5133, 0x539A, 0x55F4, 0x5842, 0x5A81, 0x5CB3, 0x5ED6, 0x60EB, 0x62F1, 0x64E7, 0x66CE, 0x68A5, 0x6A6C, 0x6C23,
    0x6DC9, 0x6F5E, 0x70E1, 0x7254, 0x73B5, 0x7503, 0x7640, 0x776B, 0x7883, 0x7989, 0x7A7C, 0x7B5C, 0x7C29, 0x7CE2,
    0x7D89, 0x7E1C, 0x7E9C, 0x7F08, 0x7F61, 0x7FA6, 0x7FD7, 0x7FF5,

    0x7FFF, 0x7FF5, 0x7FD7, 0x7FA6, 0x7F61, 0x7F08, 0x7E9C, 0x7E1C, 0x7D89, 0x7CE2, 0x7C29, 0x7B5C, 0x7A7C, 0x7989,
    0x7883, 0x776B, 0x7640, 0x7503, 0x73B5, 0x7254, 0x70E1, 0x6F5E, 0x6DC9, 0x6C23, 0x6A6C, 0x68A5, 0x66CE, 0x64E7,
    0x62F1, 0x60EB, 0x5ED6, 0x5CB3, 0x5A81, 0x5842, 0x55F4, 0x539A, 0x5133, 0x4EBF, 0x4C3F, 0x49B3, 0x471C, 0x447A,
    0x41CD, 0x3F16, 0x3C56, 0x398C, 0x36B9, 0x33DE, 0x30FB, 0x2E10, 0x2B1E, 0x2826, 0x2527, 0x2223, 0x1F19, 0x1C0B,
    0x18F8, 0x15E1, 0x12C7, 0x0FAB, 0x0C8B, 0x096A, 0x0647, 0x0324, 0x0000, 0xFCDC, 0xF9B9, 0xF696, 0xF375, 0xF055,
    0xED39, 0xEA1F, 0xE708, 0xE3F5, 0xE0E7, 0xDDDD, 0xDAD9, 0xD7DA, 0xD4E2, 0xD1F0, 0xCF05, 0xCC22, 0xC947, 0xC674,
    0xC3AA, 0xC0EA, 0xBE33, 0xBB86, 0xB8E4, 0xB64D, 0xB3C1, 0xB141, 0xAECD, 0xAC66, 0xAA0C, 0xA7BE, 0xA57F, 0xA34D,
    0xA12A, 0x9F15, 0x9D0F, 0x9B19, 0x9932, 0x975B, 0x9594, 0x93DD, 0x9237, 0x90A2, 0x8F1F, 0x8DAC, 0x8C4B, 0x8AFD,
    0x89C0, 0x8895, 0x877D, 0x8677, 0x8584, 0x84A4, 0x83D7, 0x831E, 0x8277, 0x81E4, 0x8164, 0x80F8, 0x809F, 0x805A,
    0x8029, 0x800B, 0x8001, 0x800B, 0x8029, 0x805A, 0x809F, 0x80F8, 0x8164, 0x81E4, 0x8277, 0x831E, 0x83D7, 0x84A4,
    0x8584, 0x8677, 0x877D, 0x8895, 0x89C0, 0x8AFD, 0x8C4B, 0x8DAC, 0x8F1F, 0x90A2, 0x9237, 0x93DD, 0x9594, 0x975B,
    0x9932, 0x9B19, 0x9D0F, 0x9F15, 0xA12A, 0xA34D, 0xA57F, 0xA7BE, 0xAA0C, 0xAC66, 0xAECD, 0xB141, 0xB3C1, 0xB64D,
    0xB8E4, 0xBB86, 0xBE33, 0xC0EA, 0xC3AA, 0xC674, 0xC947, 0xCC22, 0xCF05, 0xD1F0, 0xD4E2, 0xD7DA, 0xDAD9, 0xDDDD,
    0xE0E7, 0xE3F5, 0xE708, 0xEA1F, 0xED39, 0xF055, 0xF375, 0xF696, 0xF9B9, 0xFCDC, 0x0000, 0x0324, 0x0647, 0x096A,
    0x0C8B, 0x0FAB, 0x12C7, 0x15E1, 0x18F8, 0x1C0B, 0x1F19, 0x2223, 0x2527, 0x2826, 0x2B1E, 0x2E10, 0x30FB, 0x33DE,
    0x36B9, 0x398C, 0x3C56, 0x3F16, 0x41CD, 0x447A, 0x471C, 0x49B3, 0x4C3F, 0x4EBF, 0x5133, 0x539A, 0x55F4, 0x5842,
    0x5A81, 0x5CB3, 0x5ED6, 0x60EB, 0x62F1, 0x64E7, 0x66CE, 0x68A5, 0x6A6C, 0x6C23, 0x6DC9, 0x6F5E, 0x70E1, 0x7254,
    0x73B5, 0x7503, 0x7640, 0x776B, 0x7883, 0x7989, 0x7A7C, 0x7B5C, 0x7C29, 0x7CE2, 0x7D89, 0x7E1C, 0x7E9C, 0x7F08,
    0x7F61, 0x7FA6, 0x7FD7, 0x7FF5, 0x7FFF, 0x7FFF};

static br_angle const __arcsin_table[] = {
    0xC001, 0xC519, 0xC737, 0xC8D7, 0xCA37, 0xCB6D, 0xCC87, 0xCD8A, 0xCE7C, 0xCF5F, 0xD037, 0xD104, 0xD1C9, 0xD286,
    0xD33C, 0xD3ED, 0xD498, 0xD53E, 0xD5DF, 0xD67C, 0xD716, 0xD7AC, 0xD83F, 0xD8CF, 0xD95C, 0xD9E7, 0xDA6F, 0xDAF4,
    0xDB78, 0xDBF9, 0xDC79, 0xDCF7, 0xDD73, 0xDDED, 0xDE66, 0xDEDD, 0xDF53, 0xDFC8, 0xE03B, 0xE0AD, 0xE11E, 0xE18D,
    0xE1FC, 0xE26A, 0xE2D6, 0xE342, 0xE3AC, 0xE416, 0xE47F, 0xE4E7, 0xE54E, 0xE5B4, 0xE61A, 0xE67F, 0xE6E3, 0xE746,
    0xE7A9, 0xE80C, 0xE86D, 0xE8CE, 0xE92F, 0xE98F, 0xE9EE, 0xEA4D, 0xEAAB, 0xEB09, 0xEB66, 0xEBC3, 0xEC20, 0xEC7C,
    0xECD7, 0xED33, 0xED8D, 0xEDE8, 0xEE42, 0xEE9C, 0xEEF5, 0xEF4E, 0xEFA7, 0xEFFF, 0xF057, 0xF0AF, 0xF106, 0xF15D,
    0xF1B4, 0xF20B, 0xF261, 0xF2B8, 0xF30D, 0xF363, 0xF3B9, 0xF40E, 0xF463, 0xF4B8, 0xF50C, 0xF561, 0xF5B5, 0xF609,
    0xF65D, 0xF6B1, 0xF704, 0xF758, 0xF7AB, 0xF7FE, 0xF851, 0xF8A4, 0xF8F7, 0xF949, 0xF99C, 0xF9EE, 0xFA41, 0xFA93,
    0xFAE5, 0xFB37, 0xFB89, 0xFBDB, 0xFC2D, 0xFC7F, 0xFCD1, 0xFD23, 0xFD74, 0xFDC6, 0xFE17, 0xFE69, 0xFEBA, 0xFF0C,
    0xFF5E, 0xFFAF, 0x0000, 0x0051, 0x00A2, 0x00F4, 0x0146, 0x0197, 0x01E9, 0x023A, 0x028C, 0x02DD, 0x032F, 0x0381,
    0x03D3, 0x0425, 0x0477, 0x04C9, 0x051B, 0x056D, 0x05BF, 0x0612, 0x0664, 0x06B7, 0x0709, 0x075C, 0x07AF, 0x0802,
    0x0855, 0x08A8, 0x08FC, 0x094F, 0x09A3, 0x09F7, 0x0A4B, 0x0A9F, 0x0AF4, 0x0B48, 0x0B9D, 0x0BF2, 0x0C47, 0x0C9D,
    0x0CF3, 0x0D48, 0x0D9F, 0x0DF5, 0x0E4C, 0x0EA3, 0x0EFA, 0x0F51, 0x0FA9, 0x1001, 0x1059, 0x10B2, 0x110B, 0x1164,
    0x11BE, 0x1218, 0x1273, 0x12CD, 0x1329, 0x1384, 0x13E0, 0x143D, 0x149A, 0x14F7, 0x1555, 0x15B3, 0x1612, 0x1671,
    0x16D1, 0x1732, 0x1793, 0x17F4, 0x1857, 0x18BA, 0x191D, 0x1981, 0x19E6, 0x1A4C, 0x1AB2, 0x1B19, 0x1B81, 0x1BEA,
    0x1C54, 0x1CBE, 0x1D2A, 0x1D96, 0x1E04, 0x1E73, 0x1EE2, 0x1F53, 0x1FC5, 0x2038, 0x20AD, 0x2123, 0x219A, 0x2213,
    0x228D, 0x2309, 0x2387, 0x2407, 0x2488, 0x250C, 0x2591, 0x2619, 0x26A4, 0x2731, 0x27C1, 0x2854, 0x28EA, 0x2984,
    0x2A21, 0x2AC2, 0x2B68, 0x2C13, 0x2CC4, 0x2D7A, 0x2E37, 0x2EFC, 0x2FC9, 0x30A1, 0x3184, 0x3276, 0x3379, 0x3493,
    0x35C9, 0x3729, 0x38C9, 0x3AE7, 0x4000};

static br_angle const __arccos_table[] = {
    0x7FFF, 0x7AE7, 0x78C9, 0x7729, 0x75C9, 0x7493, 0x7379, 0x7276, 0x7184, 0x70A1, 0x6FC9, 0x6EFC, 0x6E37, 0x6D7A,
    0x6CC4, 0x6C13, 0x6B68, 0x6AC2, 0x6A21, 0x6984, 0x68EA, 0x6854, 0x67C1, 0x6731, 0x66A4, 0x6619, 0x6591, 0x650C,
    0x6488, 0x6407, 0x6387, 0x6309, 0x628D, 0x6213, 0x619A, 0x6123, 0x60AD, 0x6038, 0x5FC5, 0x5F53, 0x5EE2, 0x5E73,
    0x5E04, 0x5D96, 0x5D2A, 0x5CBE, 0x5C54, 0x5BEA, 0x5B81, 0x5B19, 0x5AB2, 0x5A4C, 0x59E6, 0x5981, 0x591D, 0x58BA,
    0x5857, 0x57F4, 0x5793, 0x5732, 0x56D1, 0x5671, 0x5612, 0x55B3, 0x5555, 0x54F7, 0x549A, 0x543D, 0x53E0, 0x5384,
    0x5329, 0x52CD, 0x5273, 0x5218, 0x51BE, 0x5164, 0x510B, 0x50B2, 0x5059, 0x5001, 0x4FA9, 0x4F51, 0x4EFA, 0x4EA3,
    0x4E4C, 0x4DF5, 0x4D9F, 0x4D48, 0x4CF3, 0x4C9D, 0x4C47, 0x4BF2, 0x4B9D, 0x4B48, 0x4AF4, 0x4A9F, 0x4A4B, 0x49F7,
    0x49A3, 0x494F, 0x48FC, 0x48A8, 0x4855, 0x4802, 0x47AF, 0x475C, 0x4709, 0x46B7, 0x4664, 0x4612, 0x45BF, 0x456D,
    0x451B, 0x44C9, 0x4477, 0x4425, 0x43D3, 0x4381, 0x432F, 0x42DD, 0x428C, 0x423A, 0x41E9, 0x4197, 0x4146, 0x40F4,
    0x40A2, 0x4051, 0x3FFF, 0x3FAE, 0x3F5D, 0x3F0B, 0x3EB9, 0x3E68, 0x3E16, 0x3DC5, 0x3D73, 0x3D22, 0x3CD0, 0x3C7E,
    0x3C2C, 0x3BDA, 0x3B88, 0x3B36, 0x3AE4, 0x3A92, 0x3A40, 0x39ED, 0x399B, 0x3948, 0x38F6, 0x38A3, 0x3850, 0x37FD,
    0x37AA, 0x3757, 0x3703, 0x36B0, 0x365C, 0x3608, 0x35B4, 0x3560, 0x350B, 0x34B7, 0x3462, 0x340D, 0x33B8, 0x3362,
    0x330C, 0x32B7, 0x3260, 0x320A, 0x31B3, 0x315C, 0x3105, 0x30AE, 0x3056, 0x2FFE, 0x2FA6, 0x2F4D, 0x2EF4, 0x2E9B,
    0x2E41, 0x2DE7, 0x2D8C, 0x2D32, 0x2CD6, 0x2C7B, 0x2C1F, 0x2BC2, 0x2B65, 0x2B08, 0x2AAA, 0x2A4C, 0x29ED, 0x298E,
    0x292E, 0x28CD, 0x286C, 0x280B, 0x27A8, 0x2745, 0x26E2, 0x267E, 0x2619, 0x25B3, 0x254D, 0x24E6, 0x247E, 0x2415,
    0x23AB, 0x2341, 0x22D5, 0x2269, 0x21FB, 0x218C, 0x211D, 0x20AC, 0x203A, 0x1FC7, 0x1F52, 0x1EDC, 0x1E65, 0x1DEC,
    0x1D72, 0x1CF6, 0x1C78, 0x1BF8, 0x1B77, 0x1AF3, 0x1A6E, 0x19E6, 0x195B, 0x18CE, 0x183E, 0x17AB, 0x1715, 0x167B,
    0x15DE, 0x153D, 0x1497, 0x13EC, 0x133B, 0x1285, 0x11C8, 0x1103, 0x1036, 0x0F5E, 0x0E7B, 0x0D89, 0x0C86, 0x0B6C,
    0x0A36, 0x08D6, 0x0736, 0x0518, 0x0000};

static br_angle const __arctan_table[] = {
    0x0000, 0x0028, 0x0051, 0x007A, 0x00A2, 0x00CB, 0x00F4, 0x011D, 0x0145, 0x016E, 0x0197, 0x01BF, 0x01E8, 0x0211,
    0x0239, 0x0262, 0x028B, 0x02B3, 0x02DC, 0x0304, 0x032D, 0x0355, 0x037E, 0x03A6, 0x03CE, 0x03F7, 0x041F, 0x0448,
    0x0470, 0x0498, 0x04C0, 0x04E8, 0x0511, 0x0539, 0x0561, 0x0589, 0x05B1, 0x05D9, 0x0601, 0x0628, 0x0650, 0x0678,
    0x06A0, 0x06C7, 0x06EF, 0x0716, 0x073E, 0x0765, 0x078D, 0x07B4, 0x07DB, 0x0803, 0x082A, 0x0851, 0x0878, 0x089F,
    0x08C6, 0x08ED, 0x0913, 0x093A, 0x0961, 0x0987, 0x09AE, 0x09D4, 0x09FB, 0x0A21, 0x0A47, 0x0A6D, 0x0A94, 0x0ABA,
    0x0AE0, 0x0B05, 0x0B2B, 0x0B51, 0x0B77, 0x0B9C, 0x0BC2, 0x0BE7, 0x0C0C, 0x0C32, 0x0C57, 0x0C7C, 0x0CA1, 0x0CC6,
    0x0CEB, 0x0D0F, 0x0D34, 0x0D58, 0x0D7D, 0x0DA1, 0x0DC6, 0x0DEA, 0x0E0E, 0x0E32, 0x0E56, 0x0E7A, 0x0E9E, 0x0EC1,
    0x0EE5, 0x0F08, 0x0F2C, 0x0F4F, 0x0F72, 0x0F95, 0x0FB8, 0x0FDB, 0x0FFE, 0x1021, 0x1044, 0x1066, 0x1089, 0x10AB,
    0x10CD, 0x10EF, 0x1111, 0x1133, 0x1155, 0x1177, 0x1199, 0x11BA, 0x11DC, 0x11FD, 0x121E, 0x123F, 0x1260, 0x1281,
    0x12A2, 0x12C3, 0x12E4, 0x1304, 0x1325, 0x1345, 0x1365, 0x1385, 0x13A5, 0x13C5, 0x13E5, 0x1405, 0x1424, 0x1444,
    0x1463, 0x1483, 0x14A2, 0x14C1, 0x14E0, 0x14FF, 0x151E, 0x153C, 0x155B, 0x1579, 0x1598, 0x15B6, 0x15D4, 0x15F2,
    0x1610, 0x162E, 0x164C, 0x166A, 0x1687, 0x16A5, 0x16C2, 0x16DF, 0x16FC, 0x1719, 0x1736, 0x1753, 0x1770, 0x178C,
    0x17A9, 0x17C5, 0x17E2, 0x17FE, 0x181A, 0x1836, 0x1852, 0x186E, 0x188A, 0x18A5, 0x18C1, 0x18DC, 0x18F7, 0x1913,
    0x192E, 0x1949, 0x1964, 0x197F, 0x1999, 0x19B4, 0x19CE, 0x19E9, 0x1A03, 0x1A1D, 0x1A37, 0x1A51, 0x1A6B, 0x1A85,
    0x1A9F, 0x1AB9, 0x1AD2, 0x1AEC, 0x1B05, 0x1B1E, 0x1B37, 0x1B50, 0x1B69, 0x1B82, 0x1B9B, 0x1BB4, 0x1BCC, 0x1BE5,
    0x1BFD, 0x1C16, 0x1C2E, 0x1C46, 0x1C5E, 0x1C76, 0x1C8E, 0x1CA5, 0x1CBD, 0x1CD5, 0x1CEC, 0x1D04, 0x1D1B, 0x1D32,
    0x1D49, 0x1D60, 0x1D77, 0x1D8E, 0x1DA5, 0x1DBB, 0x1DD2, 0x1DE9, 0x1DFF, 0x1E15, 0x1E2C, 0x1E42, 0x1E58, 0x1E6E,
    0x1E84, 0x1E99, 0x1EAF, 0x1EC5, 0x1EDA, 0x1EF0, 0x1F05, 0x1F1B, 0x1F30, 0x1F45, 0x1F5A, 0x1F6F, 0x1F84, 0x1F99,
    0x1FAD, 0x1FC2, 0x1FD7, 0x1FEB, 0x2000};

static br_angle const __sqrt_table[] = {
    0x8000, 0x80FF, 0x81FC, 0x82F7, 0x83F0, 0x84E7, 0x85DD, 0x86D1, 0x87C3, 0x88B4, 0x89A3, 0x8A90, 0x8B7C, 0x8C66,
    0x8D4E, 0x8E36, 0x8F1B, 0x9000, 0x90E2, 0x91C4, 0x92A4, 0x9383, 0x9460, 0x953C, 0x9617, 0x96F1, 0x97CA, 0x98A1,
    0x9977, 0x9A4C, 0x9B20, 0x9BF2, 0x9CC4, 0x9D94, 0x9E64, 0x9F32, 0xA000, 0xA0CC, 0xA197, 0xA261, 0xA32B, 0xA3F3,
    0xA4BA, 0xA581, 0xA646, 0xA70B, 0xA7CF, 0xA892, 0xA953, 0xAA15, 0xAAD5, 0xAB94, 0xAC53, 0xAD11, 0xADCD, 0xAE8A,
    0xAF45, 0xB000, 0xB0B9, 0xB172, 0xB22B, 0xB2E2, 0xB399, 0xB44F, 0xB504, 0xB5B9, 0xB66D, 0xB720, 0xB7D3, 0xB885,
    0xB936, 0xB9E7, 0xBA97, 0xBB46, 0xBBF5, 0xBCA3, 0xBD50, 0xBDFD, 0xBEA9, 0xBF55, 0xC000, 0xC0AA, 0xC154, 0xC1FD,
    0xC2A5, 0xC34E, 0xC3F5, 0xC49C, 0xC542, 0xC5E8, 0xC68E, 0xC732, 0xC7D7, 0xC87A, 0xC91D, 0xC9C0, 0xCA62, 0xCB04,
    0xCBA5, 0xCC46, 0xCCE6, 0xCD86, 0xCE25, 0xCEC3, 0xCF62, 0xD000, 0xD09D, 0xD13A, 0xD1D6, 0xD272, 0xD30D, 0xD3A8,
    0xD443, 0xD4DD, 0xD577, 0xD610, 0xD6A9, 0xD742, 0xD7DA, 0xD871, 0xD908, 0xD99F, 0xDA35, 0xDACB, 0xDB61, 0xDBF6,
    0xDC8B, 0xDD1F, 0xDDB3, 0xDE47, 0xDEDA, 0xDF6D, 0xE000, 0xE092, 0xE123, 0xE1B5, 0xE246, 0xE2D6, 0xE367, 0xE3F7,
    0xE486, 0xE515, 0xE5A4, 0xE633, 0xE6C1, 0xE74F, 0xE7DC, 0xE869, 0xE8F6, 0xE983, 0xEA0F, 0xEA9B, 0xEB26, 0xEBB1,
    0xEC3C, 0xECC7, 0xED51, 0xEDDB, 0xEE65, 0xEEEE, 0xEF77, 0xF000, 0xF088, 0xF110, 0xF198, 0xF21F, 0xF2A6, 0xF32D,
    0xF3B4, 0xF43A, 0xF4C0, 0xF546, 0xF5CB, 0xF651, 0xF6D6, 0xF75A, 0xF7DE, 0xF863, 0xF8E6, 0xF96A, 0xF9ED, 0xFA70,
    0xFAF3, 0xFB75, 0xFBF7, 0xFC79, 0xFCFB, 0xFD7C, 0xFDFD, 0xFE7E, 0xFEFF, 0xFF7F,

    0xFFFF, 0xFE05, 0xFC17, 0xFA33, 0xF85B, 0xF68C, 0xF4C8, 0xF30D, 0xF15B, 0xEFB3, 0xEE13, 0xEC7B, 0xEAEB, 0xE964,
    0xE7E3, 0xE66B, 0xE4F9, 0xE38E, 0xE229, 0xE0CC, 0xDF74, 0xDE23, 0xDCD7, 0xDB91, 0xDA51, 0xD916, 0xD7E0, 0xD6B0,
    0xD584, 0xD45E, 0xD33C, 0xD21E, 0xD105, 0xCFF1, 0xCEE1, 0xCDD4, 0xCCCC, 0xCBC8, 0xCAC8, 0xC9CB, 0xC8D2, 0xC7DD,
    0xC6EB, 0xC5FC, 0xC511, 0xC429, 0xC344, 0xC263, 0xC184, 0xC0A8, 0xBFD0, 0xBEFA, 0xBE26, 0xBD56, 0xBC88, 0xBBBD,
    0xBAF4, 0xBA2E, 0xB96A, 0xB8A9, 0xB7EA, 0xB72D, 0xB673, 0xB5BB, 0xB504, 0xB450, 0xB39F, 0xB2EF, 0xB241, 0xB195,
    0xB0EB, 0xB043, 0xAF9D, 0xAEF8, 0xAE56, 0xADB5, 0xAD16, 0xAC79, 0xABDD, 0xAB43, 0xAAAA, 0xAA13, 0xA97E, 0xA8EA,
    0xA858, 0xA7C7, 0xA737, 0xA6A9, 0xA61D, 0xA592, 0xA508, 0xA47F, 0xA3F8, 0xA372, 0xA2EE, 0xA26A, 0xA1E8, 0xA167,
    0xA0E7, 0xA069, 0x9FEC, 0x9F6F, 0x9EF4, 0x9E7A, 0x9E01, 0x9D89, 0x9D13, 0x9C9D, 0x9C28, 0x9BB4, 0x9B42, 0x9AD0,
    0x9A5F, 0x99EF, 0x9981, 0x9913, 0x98A6, 0x983A, 0x97CE, 0x9764, 0x96FB, 0x9692, 0x962A, 0x95C3, 0x955D, 0x94F8,
    0x9493, 0x9430, 0x93CD, 0x936B, 0x9309, 0x92A9, 0x9249, 0x91E9, 0x918B, 0x912D, 0x90D0, 0x9074, 0x9018, 0x8FBD,
    0x8F63, 0x8F09, 0x8EB0, 0x8E58, 0x8E00, 0x8DA9, 0x8D53, 0x8CFD, 0x8CA8, 0x8C53, 0x8BFF, 0x8BAC, 0x8B59, 0x8B06,
    0x8AB5, 0x8A64, 0x8A13, 0x89C3, 0x8973, 0x8924, 0x88D6, 0x8888, 0x883B, 0x87EE, 0x87A1, 0x8755, 0x870A, 0x86BF,
    0x8675, 0x862B, 0x85E1, 0x8598, 0x8550, 0x8508, 0x84C0, 0x8479, 0x8432, 0x83EC, 0x83A6, 0x8361, 0x831C, 0x82D7,
    0x8293, 0x824F, 0x820C, 0x81C9, 0x8186, 0x8144, 0x8103, 0x80C1, 0x8080, 0x8040,
};

static br_angle const *__sin_table = &__sincos_table[0];
static br_angle const *__cos_table = &__sincos_table[64];
static br_angle const *__sqrt_nr_table = &__sqrt_table[0];
static br_angle const *__sqrt_r_table = &__sqrt_table[64];

static inline br_fixed_lsf __BrInterpTable(br_angle const *table, br_angle const i)
{
    br_uint_8 lo = (i & 0x00FF);
    br_uint_8 hi = (i & 0xFF00) >> 8;

    br_fixed_lsf val0 = table[hi];
    br_fixed_lsf val1 = table[hi + 1];

    br_int_32 lerp = (val1 - val0) * lo;
    return (lerp >> 8) + val0;
}

static inline br_uint_32 __BrSqrt64(br_uint_64 a)
{
    br_int_32 error = 0;
    br_int_32 estimate = 0;
    br_int_32 estimate_mul2 = 0;

    br_uint_32 hi = a >> 32;
    br_uint_32 lo = a;

    for (int i = 0; i < 16; i++)
    {
        error <<= 2;
        error |= hi >> (32 - 2);
        hi <<= 2;

        estimate *= 2;
        estimate_mul2 *= 2;

        if (estimate_mul2 < error)
        {
            error -= estimate_mul2 + 1;
            estimate += 1;
            estimate_mul2 += 2;
        }
    }

    for (int i = 0; i < 16; i++)
    {
        error <<= 2;
        error |= lo >> (32 - 2);
        lo <<= 2;

        estimate *= 2;
        estimate_mul2 *= 2;

        if (estimate_mul2 < error)
        {
            error -= estimate_mul2 + 1;
            estimate += 1;
            estimate_mul2 += 2;
        }
    }

    return estimate;
}

static inline br_uint_32 __BrFastRSqrt(br_uint_64 a)
{
    unsigned char clz = __BrBuiltinCLZ(a);
    if (clz == 0)
    {
        return 0;
    }

    clz |= 1;
    a = __BrBuiltinROR(a, clz);
    a = __BrBuiltinROR(a, 1);
    a >>= 24;

    br_uint_32 result = __sqrt_r_table[a * 2];

    clz >>= 1;
    result >>= clz;

    return result;
}

static inline br_uint_32 __BrFastRSqrt64(br_uint_64 a)
{
    if ((a >> 32) != 0)
    {
        return __BrFastRSqrt(a >> 32);
    }
    else
    {
        return __BrFastRSqrt(a);
    }
}

br_fixed_ls BR_ASM_CALL BrFixedAbs(br_fixed_ls a)
{
    if (a >= 0)
    {
        return a;
    }
    else
    {
        return -a;
    }
}

br_fixed_ls BR_ASM_CALL BrFixedMul(br_fixed_ls a, br_fixed_ls b)
{
    br_int_64 mul = (br_int_64)a * (br_int_64)b;
    return mul >> 16;
}

br_fixed_ls BR_ASM_CALL BrFixedDiv(br_fixed_ls a, br_fixed_ls b)
{
    br_int_64 __a = (br_int_64)a << 16;
    return __BrBuiltinDivI64I32(__a, b);
}

br_fixed_ls BR_ASM_CALL BrFixedDivF(br_fixed_ls a, br_fixed_ls b)
{
    br_int_64 __a = (br_int_64)a << 31;
    return __BrBuiltinDivI64I32(__a, b);
}

br_fixed_ls BR_ASM_CALL BrFixedDivR(br_fixed_ls a, br_fixed_ls b)
{
    // NOTE(bjrkk): this isn't really how it originally was done but
    // it still ends up giving extremely close results.
    return BrFixedDiv(a, b) & 0x0000FFFF;
}

br_fixed_ls BR_ASM_CALL BrFixedMulDiv(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c)
{
    br_int_64 mul = (br_int_64)a * (br_int_64)b;
    return __BrBuiltinDivI64I32(mul, c);
}

br_fixed_ls BR_ASM_CALL BrFixedMac2(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    return (br_uint_64)(ab + cd) >> 16;
}

br_fixed_ls BR_ASM_CALL BrFixedMac3(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d, br_fixed_ls e,
                                    br_fixed_ls f)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    br_int_64 ef = (br_int_64)e * (br_int_64)f;
    return (br_uint_64)(ab + cd + ef) >> 16;
}

br_fixed_ls BR_ASM_CALL BrFixedMac4(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d, br_fixed_ls e,
                                    br_fixed_ls f, br_fixed_ls g, br_fixed_ls h)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    br_int_64 ef = (br_int_64)e * (br_int_64)f;
    br_int_64 gh = (br_int_64)g * (br_int_64)h;
    return (br_uint_64)(ab + cd + ef + gh) >> 16;
}

br_fixed_ls BR_ASM_CALL BrFixedMac2Div(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d, br_fixed_ls e)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    return __BrBuiltinDivI64I32(ab + cd, e);
}

br_fixed_ls BR_ASM_CALL BrFixedMac3Div(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d, br_fixed_ls e,
                                       br_fixed_ls f, br_fixed_ls g)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    br_int_64 ef = (br_int_64)e * (br_int_64)f;
    return __BrBuiltinDivI64I32(ab + cd + ef, g);
}

/* result = (a*b + c*d + e*f + g*h)/i
 */
br_fixed_ls BR_ASM_CALL BrFixedMac4Div(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d, br_fixed_ls e,
                                       br_fixed_ls f, br_fixed_ls g, br_fixed_ls h, br_fixed_ls i)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    br_int_64 ef = (br_int_64)e * (br_int_64)f;
    br_int_64 gh = (br_int_64)g * (br_int_64)h;
    return __BrBuiltinDivI64I32(ab + cd + ef + gh, i);
}

br_fixed_ls BR_ASM_CALL BrFixedFMac2(br_fixed_lsf a, br_fixed_ls b, br_fixed_lsf c, br_fixed_ls d)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    return (br_uint_64)(ab + cd) >> 15;
}

/* result = a*b + c*d + e*f - a,c & e are fractions
 */
br_fixed_ls BR_ASM_CALL BrFixedFMac3(br_fixed_lsf a, br_fixed_ls b, br_fixed_lsf c, br_fixed_ls d, br_fixed_lsf e,
                                     br_fixed_ls f)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    br_int_64 ef = (br_int_64)e * (br_int_64)f;
    return (br_uint_64)(ab + cd + ef) >> 15;
}

/* result = a*b + c*d + e*f + g*h (a,c,e,g are fractions)
 */
br_fixed_ls BR_ASM_CALL BrFixedFMac4(br_fixed_lsf a, br_fixed_ls b, br_fixed_lsf c, br_fixed_ls d, br_fixed_lsf e,
                                     br_fixed_ls f, br_fixed_lsf g, br_fixed_ls h)
{
    br_int_64 ab = (br_int_64)a * (br_int_64)b;
    br_int_64 cd = (br_int_64)c * (br_int_64)d;
    br_int_64 ef = (br_int_64)e * (br_int_64)f;
    br_int_64 gh = (br_int_64)g * (br_int_64)h;
    return (br_uint_64)(ab + cd + ef + gh) >> 15;
}

br_fixed_ls BR_ASM_CALL BrFixedRcp(br_fixed_ls a)
{
    return BrFixedDiv(BR_SCALAR(1), a);
}

br_fixed_ls BR_ASM_CALL BrFixedSqr(br_fixed_ls a)
{
    return BrFixedMul(a, a);
}

br_fixed_ls BR_ASM_CALL BrFixedSqr2(br_fixed_ls a, br_fixed_ls b)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    return (aa + bb) >> 16;
}

br_fixed_ls BR_ASM_CALL BrFixedSqr3(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    br_int_64 cc = (br_int_64)c * (br_int_64)c;
    return (aa + bb + cc) >> 16;
}

br_fixed_ls BR_ASM_CALL BrFixedSqr4(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    br_int_64 cc = (br_int_64)c * (br_int_64)c;
    br_int_64 dd = (br_int_64)d * (br_int_64)d;
    return (aa + bb + cc + dd) >> 16;
}

br_fixed_ls BR_ASM_CALL BrFixedLength2(br_fixed_ls a, br_fixed_ls b)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    return __BrSqrt64(aa + bb);
}

br_fixed_ls BR_ASM_CALL BrFixedLength3(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    br_int_64 cc = (br_int_64)c * (br_int_64)c;
    return __BrSqrt64(aa + bb + cc);
}

br_fixed_ls BR_ASM_CALL BrFixedLength4(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    br_int_64 cc = (br_int_64)c * (br_int_64)c;
    br_int_64 dd = (br_int_64)d * (br_int_64)d;
    return __BrSqrt64(aa + bb + cc + dd);
}

br_fixed_ls BR_ASM_CALL BrFixedRLength2(br_fixed_ls a, br_fixed_ls b)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    return __BrFastRSqrt64(aa + bb);
}

br_fixed_ls BR_ASM_CALL BrFixedRLength3(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    br_int_64 cc = (br_int_64)c * (br_int_64)c;
    return __BrFastRSqrt64(aa + bb + cc);
}

br_fixed_ls BR_ASM_CALL BrFixedRLength4(br_fixed_ls a, br_fixed_ls b, br_fixed_ls c, br_fixed_ls d)
{
    br_int_64 aa = (br_int_64)a * (br_int_64)a;
    br_int_64 bb = (br_int_64)b * (br_int_64)b;
    br_int_64 cc = (br_int_64)c * (br_int_64)c;
    br_int_64 dd = (br_int_64)d * (br_int_64)d;
    return __BrFastRSqrt64(aa + bb + cc + dd);
}

br_fixed_ls BR_ASM_CALL BrFixedSin(br_angle a)
{
    br_fixed_ls value = __BrInterpTable(__sin_table, a);
    return value + value;
}

br_fixed_ls BR_ASM_CALL BrFixedCos(br_angle a)
{
    br_fixed_ls value = __BrInterpTable(__cos_table, a);
    return value + value;
}

br_angle BR_ASM_CALL BrFixedASin(br_fixed_ls a)
{
    a += (1 << 16);
    a >>= 1;
    return __BrInterpTable(__arcsin_table, a);
}

br_angle BR_ASM_CALL BrFixedACos(br_fixed_ls a)
{
    a += (1 << 16);
    a >>= 1;
    return __BrInterpTable(__arccos_table, a);
}

br_angle BR_ASM_CALL BrFixedATan2(br_fixed_ls x, br_fixed_ls y)
{
    // TODO(bjrkk): Get this out of goto hell

    if (x < 0)
    {
        goto octant_4567;
    }
    else if (x == 0)
    {
        goto y_zero;
    }

octant_0123:
    if (y < 0)
    {
        goto octant_23;
    }

octant_01:
    if (y < x)
    {
        goto octant_1;
    }
    else if (y == x)
    {
        goto boundary_01;
    }

octant_0:
    return __BrInterpTable(__arctan_table, BrFixedDiv(x, y));

boundary_01:
    return 0x2000;

octant_1:
    return 0x4000 - __BrInterpTable(__arctan_table, BrFixedDiv(y, x));

octant_23:
    y = -y;
    if (y > x)
    {
        goto octant_3;
    }
    else if (y == x)
    {
        goto boundary_23;
    }

octant_2:
    return 0x4000 + __BrInterpTable(__arctan_table, BrFixedDiv(y, x));

boundary_23:
    return 0x6000;

octant_3:
    return 0x8000 - __BrInterpTable(__arctan_table, BrFixedDiv(x, y));

octant_4567:
    x = -x;
    if (y > 0)
    {
        goto octant_67;
    }

octant_45:
    y = -y;
    if (y < x)
    {
        goto octant_5;
    }
    else if (y == x)
    {
        goto boundary_45;
    }

octant_4:
    return 0x8000 + __BrInterpTable(__arctan_table, BrFixedDiv(x, y));

boundary_45:
    return 0xA000;

octant_5:
    return 0xC000 - __BrInterpTable(__arctan_table, BrFixedDiv(y, x));

octant_67:
    if (y > x)
    {
        goto octant_7;
    }
    else if (y == x)
    {
        goto boundary_67;
    }

octant_6:
    return 0xC000 + __BrInterpTable(__arctan_table, BrFixedDiv(y, x));

boundary_67:
    return 0xE000;

octant_7:
    return -__BrInterpTable(__arctan_table, BrFixedDiv(x, y));

y_zero:
    if (y < 0)
    {
        return 0x8000;
    }
    return 0;
}

br_angle BR_ASM_CALL BrFixedATan2Fast(br_fixed_ls x, br_fixed_ls y)
{
    // TODO(bjrkk): Get this out of goto hell

    if (x < 0)
    {
        goto octant_4567;
    }
    else if (x == 0)
    {
        goto x_zero;
    }

octant_0123:
    if (y < 0)
    {
        goto octant_23;
    }

octant_01:
    if (y < x)
    {
        goto octant_1;
    }
    else if (y == x)
    {
        goto boundary_01;
    }

octant_0:
    return ((x / y) >> 19);

octant_1:
    return 0x4000 + -((y / x) >> 19);

boundary_01:
    return 0x2000;

octant_23:
    y = -y;
    if (y > x)
    {
        goto octant_3;
    }
    else if (y == x)
    {
        goto boundary_23;
    }

octant_2:
    return 0x4000 + ((y / x) >> 19);

boundary_23:
    return 0x6000;

octant_3:
    return 0x8000 + -((x / y) >> 19);

octant_4567:
    x = -x;
    if (y > 0)
    {
        goto octant_67;
    }
    else if (y == 0)
    {
        goto boundary_45;
    }

octant_45:
    y = -y;
    if (y < x)
    {
        goto octant_5;
    }

octant_4:
    return 0x8000 + ((x / y) >> 19);

boundary_45:
    return 0xA000;

octant_5:
    return 0xC000 + -((y / x) >> 19);

octant_67:
    if (y > x)
    {
        goto octant_7;
    }
    else if (y == x)
    {
        goto boundary_67;
    }

octant_6:
    return 0xC000 + ((y / x) >> 19);

boundary_67:
    return 0xE000;

octant_7:
    return -((x / y) >> 19);

x_zero:
    if (y < 0)
    {
        return 0x8000;
    }

    return 0;
}